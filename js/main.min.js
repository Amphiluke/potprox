{let t={readFile:t=>new Promise((e,a)=>{let i=new FileReader;i.addEventListener("load",()=>e(i.result)),i.addEventListener("error",()=>a(i.error)),i.readAsText(t)})},e={parseCSV(t){let e=(t=t.trim()).includes(";")?";":",";return","!==e&&(t=t.replace(/,/g,".")),t.split(/(?:\r?\n)+/).map(t=>{let[a,i]=t.split(e).map(Number);return{x:a,y:i}})},winbondToCSV(t,e,a){let i=t.trim().split(/\r?\n/),r=e.trim().split(/\r?\n/),l=a.trim().split(/\r?\n/);if(i.length!==r.length||i.length!==l.length)throw new Error("Winbond files contain mismatched or corrupted data");let n=/\s+/;return i.map((t,e)=>{let a=t.trim().split(n),i=Number(a[0]),s=Number(a[1]);if(a=r[e].trim().split(n),Number(a[0])!==i)throw new Error("Winbond files contain mismatched or corrupted data");if(s+=Number(a[a.length-1]),a=l[e].trim().split(n),Number(a[0])!==i)throw new Error("Winbond files contain mismatched or corrupted data");return s+=Number(a[a.length-1]),`${i},${s.toFixed(8)}`}).join("\n")},toPotprox:t=>t.map(({x:t,y:e})=>({r:t,e:e})),approximate(t,e){let a=this.toPotprox(t),i=window.potprox[e].from(a);return i._rSqr=i.rSqr(a),i},makeCurveData:(t,e,a)=>[...t.points({start:e,end:a})].map(({r:t,e:e})=>({x:t,y:e}))},a={config:{type:"line",data:{datasets:[{borderColor:"transparent",fill:!1,pointBorderColor:"#f9df08"},{borderColor:"#039c35",fill:!1,pointRadius:0,pointHoverRadius:0}]},options:{animation:{duration:0},legend:{display:!1},scales:{xAxes:[{type:"linear",position:"bottom",gridLines:{color:"#014c1a",zeroLineColor:"#014c1a"},ticks:{fontColor:"#c9b405"}}],yAxes:[{gridLines:{color:"#014c1a",zeroLineColor:"#014c1a"},ticks:{fontColor:"#c9b405"}}]},tooltips:{enabled:!1}}},createChart(t,e,a){this.config.data.datasets[0].data=e,this.config.data.datasets[1].data=a,this.chart=new window.Chart(t,this.config)},update(t,e){this.chart.data.datasets[0].data=t,this.chart.data.datasets[1].data=e,this.chart.update()}};({ui:new Map([...document.body.querySelectorAll("[id]")].map(t=>["#"+t.id,t])),init(){this.addEventListeners(),this.updateChart()},updateChart(t){let i=this.ui,r=e.parseCSV(i.get("#data").value),l=i.get("#potential").value;this.potential=t||e.approximate(r,l);let n=r.map(({x:t})=>t),s=e.makeCurveData(this.potential,Math.min(...n),Math.max(...n));this.updateParamSlots(),a.chart?a.update(r,s):a.createChart(i.get("#graph").getContext("2d"),r,s)},updateParamSlots(){let t=this.potential,e=t?Object.assign({rSqr:t._rSqr},t.toJSON()):{},a=e.type?`[data-potential="${e.type}"]`:"[data-potential]";[...this.ui.get("#ctrl-form").querySelectorAll(`.result${a} input[name]`)].forEach(t=>t.value=e[t.name]||"")},addEventListener(t,e,a){let i="string"==typeof t?this.ui.get(t):t,r="string"==typeof a?this[a].bind(this):a;i.addEventListener(e,r,!1)},addEventListeners(){this.addEventListener("#file-tab-ctrl","click","clickTabCtrlHandler"),this.addEventListener("#file-csv","change","fileCSVChangeHandler"),this.addEventListener(this.ui.get("#file-tab-ctrl").querySelector(".tab-sheet[data-format='winbond']"),"change","fileWinbondChangeHandler"),this.addEventListener("#data","input","dataInputHandler"),this.addEventListener("#data","change","dataChangeHandler"),this.addEventListener("#potential","change","potentialChangeHandler"),this.addEventListener("#ctrl-form","submit","submitHandler"),this.addEventListener("#result-group","change","paramChangeHandler")},clickTabCtrlHandler({target:t}){if(!t.classList.contains("tab")||t.classList.contains("tab-active"))return;[...this.ui.get("#file-tab-ctrl").querySelectorAll(".tab")].forEach(e=>e.classList.toggle("tab-active",e===t));let e=t.dataset.format;[...this.ui.get("#file-tab-ctrl").querySelectorAll(".tab-sheet")].forEach(t=>t.classList.toggle("hidden",t.dataset.format!==e))},fileCSVChangeHandler({target:e}){let a=e.files[0];a&&(t.readFile(a).then(t=>this.ui.get("#data").value=t).catch(t=>console.error(t)),this.potential=null,this.updateParamSlots())},fileWinbondChangeHandler(){let a=this.ui,i=a.get("#file-kul").files[0],r=a.get("#file-sum1").files[0],l=a.get("#file-sum2").files[0];i&&r&&l&&(Promise.all([t.readFile(i),t.readFile(r),t.readFile(l)]).then(([t,a,i])=>this.ui.get("#data").value=e.winbondToCSV(t,a,i)).catch(t=>console.error(t)),this.potential=null,this.updateParamSlots())},dataInputHandler({target:t}){let e=t.value.trim();if(e.includes("\t")){let a=e.includes(",")?";":",";t.value=e.replace(/\t/g,a)}},dataChangeHandler(){this.potential=null,this.updateParamSlots()},potentialChangeHandler({target:t}){let e=t.value;[...this.ui.get("#ctrl-form").querySelectorAll("[data-potential]")].forEach(t=>t.classList.toggle("hidden",t.getAttribute("data-potential")!==e)),this.potential=null,this.updateParamSlots()},submitHandler(t){t.preventDefault(),this.updateChart(),this.ui.get("#result-group").classList.remove("user-modified")},paramChangeHandler({target:t}){if(!this.potential)return;this.ui.get("#result-group").classList.add("user-modified");let e=Number(t.value);e&&(this.potential[t.name]=e,this.potential._rSqr=void 0,this.updateChart(this.potential))}}).init(),"serviceWorker"in navigator&&navigator.serviceWorker.register("/potprox/sw.js")}